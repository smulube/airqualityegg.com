<section class="claiming clearfix">
  <form class="claiming-form" method="post" action="/register">
    <input class="input claiming-input" type="text" id="serial" name="serial" placeholder="Serial Number">
    <input class="button claiming-button" type="submit" name="submit" value="Add my egg">
  </form>
  <p class="bubble bubble-error claiming-error<% if !@error %> hidden<% end %>"><%= @error %></p>
</section>

<section class="dashboard-current">
  <img class="dashboard-current-prop" src="/assets/img/prop-bigegg.png">
  <div class="dashboard-current-values clearfix">
    
    <div class="current current-left current-no2">
      <h2 class="current-id">NO2</h2>
      <h3 class="current-id-full">Nitrogen Dioxide</h3>
      <div class="current-value">
        <p class="current-value-measure">
          <span class="current-value-measure-wrap" id="current-value-no2"><%= @no2 ? @no2.current_value : "<small class='current-value-unavailable'>Not available yet.</small>" %></span>
        </p>
        <span class="current-gauge"></span>
        <span class="current-gauge-filling current-gauge-green"></span>
      </div>
    </div>

    <div class="current current-left current-co">
      <h2 class="current-id">CO</h2>
      <h3 class="current-id-full">Carbon Monoxide</h3>
      <div class="current-value">
        <p class="current-value-measure">
          <span class="current-value-measure-wrap" id="current-value-co"><%= @co ? @co.current_value : "<small class='current-value-unavailable'>Not available yet.</small>" %></span>
        </p>
        <span class="current-gauge"></span>
        <span class="current-gauge-filling current-gauge-green"></span>
      </div>
    </div>

    <div class="current current-right current-temperature">
      <h2 class="current-id heading-narrow">Temperature</h2>
      <div class="current-value">
        <p class="current-value-measure">
          <span class="current-value-measure-wrap" id="current-value-temperature"><%= @temperature ? @temperature.current_value : "<small class='current-value-unavailable'>Not available yet.</small>" %></span>
        </p>
        <span class="current-gauge"></span>
        <span class="current-gauge-filling"></span>
      </div>
    </div>
    
    <div class="current current-right current-humidity">
      <h2 class="current-id heading-narrow">Humidity</h2>
      <div class="current-value">
        <p class="current-value-measure">
          <span class="current-value-measure-wrap" id="current-value-humidity"><%= @humidity ? @humidity.current_value : "<small class='current-value-unavailable'>Not available yet.</small>" %></span>
        </p>
        <span class="current-gauge"></span>
        <span class="current-gauge-filling"></span>
      </div>
    </div>
  </div>

  <p class="dashboard-updated">Last updated <%= string_to_time(@feed.updated) %></p>
</section>

<section class="dashboard-metadata">
  <h1 class="metadata-feed-title"><%= @feed.title %></h1>
  <% if @feed.location_exposure %>
  <h2 class="metadata-title">Exposure</h2>
  <p class="metadata-value"><%= @feed.location_exposure %></p>
  <% end %>
  <% if @feed.location_ele %>
  <h2 class="metadata-title">Elevation</h2>
  <p class="metadata-value"><%= @feed.location_ele %></p>
  <% end %>
  <% if @feed.description %>
  <h2 class="metadata-title">Description</h2>
  <p class="metadata-value metadata-description"><%= @feed.description %></p>
  <% end %>
</section>

<script>
  var mapmarkers = <%= @map_markers %>;
</script>

<section class="dashboard-map-container">
  <div class="map dashboard-map" id="map_canvas" style="width:100%;height:500px;"></div>
  <div class="map-overlay">
    <p class="map-overlay-loading">Loading Egg <span>.</span><span>.</span><span>.</span></p>
  </div>
</section>

<% content_for :javascript do %>
  <script>
    cosm.setKey("<%= $api_key %>");

    <% if @no2 %>
      $('#current-value-no2').cosm('live', { feed: <%= @feed.id %>, datastream: '<%= @no2.id %>' });
    <% end %>
    <% if @co %>
      $('#current-value-co').cosm('live', { feed: <%= @feed.id %>, datastream: '<%= @co.id %>' });
    <% end %>
    <% if @temperature %>
      $('#current-value-temperature').cosm('live', { feed: <%= @feed.id %>, datastream: '<%= @temperature.id %>' });
    <% end %>
    <% if @humidity %>
      $('#current-value-humidity').cosm('live', { feed: <%= @feed.id %>, datastream: '<%= @humidity.id %>' });
    <% end %>
  </script>

<% end %>
